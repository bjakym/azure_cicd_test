name: 'Deploy Test'

on:
  workflow_dispatch:

env:
  TF_LOG: INFO

jobs:
  get_tf_folders:
    name: 'Get Terraform folders'
    runs-on: azure-cicd

    defaults:
      run:
        shell: bash

    outputs:
      directories: ${{ steps.transform.outputs.directories }}

    steps:
    # Checkout the repository to the GitHub Actions runner
    - name: Checkout
      uses: actions/checkout@v2

    - name: Get Terraform Folders
      id: tfdirs
      uses: tj-actions/changed-files@v41
      with:
        files: |
            **.tf
        dir_names: true

    - name: Convert Folder List to Json
      id: tfdirsjson
      continue-on-error: false
      run: |
        folders_json="["
        for dir in ${{ steps.tfdirs.outputs.all_changed_files }}; do
          folders_json+="\"${dir}\","
        done
        folders_json="${folders_json%,}]"
        echo "directories=${folders_json}"
        echo "directories=${folders_json}" >> $GITHUB_OUTPUT